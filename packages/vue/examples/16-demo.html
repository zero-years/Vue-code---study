<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div id="app"></div>

    <script type="module">
      // import {
      //   //   h,
      //   render,
      // } from '../../../node_modules/vue/dist/vue.esm-browser.js'

      import {
        h,
        ref,
        createApp,
        getCurrentInstance,
        onBeforeMount,
        onMounted,
        onUpdated,
        onBeforeUpdate,
        onBeforeUnmount,
        onUnmounted,
        useTemplateRef,
      } from '../dist/vue.esm.js'

      const Child = {
        setup(props, { attrs, slots, emit, expose }) {
          /**
           * expose 子组件给父组件暴露的方法，父组件可以通过 ref 获取
           * 如果子组件有通过 expose 暴露内容，那么父组件通过 ref 只能拿到子组件暴露的内容和 $slots | $props | ... 这些内容
           * 如果用户没用通过 expose 暴露内容，那父组件通过 ref 可以获得 instance.proxy 上的内容
           */
          expose({
            a: ref(0),
            foo() {
              return '子组件暴露的 foo 方法'
            },
          })

          return () => {
            return h('div', ['我是子组件'])
          }
        },
      }

      const Comp = {
        setup() {
          const childRef = ref()
          const vm = getCurrentInstance()

          onMounted(() => {
            // document.querySelector('#container')
            // console.log(elRef.value)
            // console.log(childRef.value.a)
            console.log(vm.proxy.$refs.childRef.a)
          })

          const flag = ref(true)

          setTimeout(() => {
            flag.value = false
          }, 1000)

          return () => {
            return h('div', [
              h('p', { id: 'container', ref: 'elRef' }, '我是父组件的p标签'),
              flag.value
                ? h(Child, {
                    ref: 'childRef',
                  })
                : '',
            ])
          }
        },
      }
      // const Comp = {
      //   setup() {
      //     const el = useTemplateRef('elRef')

      //     onMounted(() => {
      //       // document.querySelector('#container')
      //       // console.log(elRef.value)
      //       // console.log(childRef.value.a)
      //       // console.log(vm.proxy.$refs.childRef.a)
      //       console.log(el.value)
      //     })

      //     const flag = ref(true)

      //     setTimeout(() => {
      //       flag.value = false
      //     }, 1000)

      //     return () => {
      //       return h('div', [
      //         h('p', { id: 'container', ref: 'elRef' }, '我是父组件的p标签'),
      //       ])
      //     }
      //   },
      // }

      const app = createApp(Comp)

      app.mount('#app')
    </script>
  </body>
</html>
