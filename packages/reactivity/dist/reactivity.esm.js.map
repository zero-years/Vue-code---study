{
  "version": 3,
  "sources": ["../../shared/src/index.ts", "../src/system.ts", "../src/effect.ts", "../src/dep.ts", "../src/baseHandlers.ts", "../src/reavtive.ts", "../src/ref.ts", "../src/computed.ts", "../src/watch.ts"],
  "sourcesContent": ["export function isObject(value) {\r\n  return typeof value == 'object' && value !== null\r\n}\r\n\r\n/**\r\n * \u5224\u65AD\u503C\u662F\u5426\u53D8\u5316\u3002\u662F\u4E3A true\r\n * @param newValue \u65B0\u503C\r\n * @param oldValue \u8001\u503C\r\n * @returns\r\n */\r\nexport function hasChanged(newValue, oldValue) {\r\n  return !Object.is(newValue, oldValue)\r\n}\r\n\r\n/**\r\n * \u5224\u65AD\u503C\u662F\u5426\u4E3A\u51FD\u6570\uFF0C\u662F\u4E3A true\r\n */\r\nexport function isFunction(value) {\r\n  return typeof value === 'function'\r\n}\r\n", "// \u4F9D\u8D56\u9879\r\nexport interface Dependency {\r\n  // \u8BA2\u9605\u8005\u94FE\u8868\u7684\u5934\u8282\u70B9\r\n  subs: Link | undefined\r\n  // \u8BA2\u9605\u8005\u94FE\u8868\u7684\u5C3E\u8282\u70B9\r\n  subsTail: Link | undefined\r\n}\r\n\r\n// Sub \u8BA2\u9605\u8005\r\nexport interface Sub {\r\n  // \u8BA2\u9605\u8005\u94FE\u8868\u7684\u5934\u8282\u70B9\r\n  deps: Link | undefined\r\n  // \u8BA2\u9605\u8005\u94FE\u8868\u7684\u5C3E\u8282\u70B9\r\n  depsTail: Link | undefined\r\n  // tracking \u7528\u4E8E\u5224\u65AD\u662F\u5426\u5DF2\u7ECF\u8FFD\u8E2A\r\n  tracking: boolean\r\n}\r\n\r\n/**\r\n * \u94FE\u8868\u8282\u70B9 \u7528\u6765\u50A8\u5B58 effect \u51FD\u6570\r\n */\r\nexport interface Link {\r\n  // effect \u51FD\u6570\r\n  sub: Sub\r\n  // \u4E0B\u4E00\u4E2A\u8BA2\u9605\u8005\u8282\u70B9\r\n  nextSub: Link | undefined\r\n  // \u4E0A\u4E00\u4E2A\u8BA2\u9605\u8005\u8282\u70B9\r\n  prevSub: Link | undefined\r\n\r\n  // \u4F9D\u8D56\u9879\r\n  dep: Dependency\r\n  // \u4E0B\u4E00\u4E2A\u4F9D\u8D56\u9879\r\n  nextDep: Link | undefined\r\n}\r\n\r\n// \u4FDD\u5B58\u4E00\u4E2A\u5DF2\u7ECF\u521B\u5EFA\u8FC7\u4F46\u88AB\u6E05\u9664\u7684\u8282\u70B9\r\nlet linkPool: Link\r\n\r\n/**\r\n * \u94FE\u63A5\u94FE\u8868\u5173\u7CFB\uFF0C \u6536\u96C6\u4F9D\u8D56\r\n * @param dep\r\n * @param sub \u8BA2\u9605\u8005\uFF0C\u4F9D\u8D56\u53D8\u5316\u65F6\u9700\u8981\u901A\u77E5\u7684 effect \u51FD\u6570\uFF0C\u4ECE\u800C\u91CD\u65B0\u6267\u884C\r\n */\r\nexport function link(dep, sub) {\r\n  // region \u5C1D\u8BD5\u590D\u7528\u94FE\u8868\u8282\u70B9\r\n  const currentDep = sub.depsTail\r\n\r\n  /**\r\n   * \u5206\u4E24\u79CD\u60C5\u51B5\r\n   * P1: \u5934\u8282\u70B9\u5B58\u5728\uFF0C\u5C3E\u8282\u70B9\u4E3A undefined \uFF0C \u590D\u7528\u5934\u8282\u70B9\r\n   * P2: \u5C3E\u8282\u70B9\u5B58\u5728 nextDep \uFF0C\u590D\u7528\u5C3E\u8282\u70B9\u7684\u4E0B\u4E00\u4E2A\u8282\u70B9 nextDep\r\n   */\r\n  const nextDep = currentDep === undefined ? sub.deps : currentDep.nextDep\r\n\r\n  if (nextDep && nextDep.dep === dep) {\r\n    sub.depsTail = nextDep\r\n    return\r\n  }\r\n  // endregion\r\n\r\n  // \u5982\u679C\u5B58\u5728 activeSub \uFF0C\u5C31\u4FDD\u5B58\u8D77\u6765\uFF0C\u7B49 set(\u66F4\u65B0\u65F6)\u89E6\u53D1\r\n  let newLink: Link | undefined\r\n\r\n  /**\r\n   * \u67E5\u770B\u662F\u5426\u5177\u6709 linkPool \uFF0C\u5982\u679C\u5177\u6709 linkPool \uFF0C\u5219\u8BC1\u660E\u4E4B\u524D\u5177\u6709\u53EF\u4EE5\u590D\u7528\u7684\u8282\u70B9\uFF0C\u5C31\u590D\u7528\u4E4B\u524D\u7684\u8282\u70B9\uFF0C\u6CA1\u6709\u5C31\u521B\u5EFA\u65B0\u7684\u8282\u70B9\r\n   */\r\n  if (linkPool) {\r\n    newLink = linkPool\r\n    linkPool = linkPool.nextDep\r\n    newLink.nextDep = nextDep\r\n    newLink.dep = dep\r\n    newLink.sub = sub\r\n  } else {\r\n    newLink = {\r\n      dep,\r\n      nextDep,\r\n      sub,\r\n      nextSub: undefined,\r\n      prevSub: undefined,\r\n    }\r\n  }\r\n\r\n  // region \u5C06\u94FE\u8868\u8282\u70B9\u548C  dep \u5EFA\u7ACB\u5173\u8054\u5173\u7CFB\r\n  // \u5B9E\u73B0\u903B\u8F91\r\n  /**\r\n   * \u5173\u8054\u53CC\u5411\u94FE\u8868\u5173\u7CFB\uFF0C\u5206\u4E24\u79CD\u60C5\u51B5\r\n   * 1. \u5B58\u5728\u5C3E\u8282\u70B9\uFF0C\u5F80\u5C3E\u8282\u70B9\u540E\u9762\u52A0\r\n   * 2. \u4E0D\u5B58\u5728\u4E3A\u8282\u70B9\uFF0C\u5219\u8868\u793A\u7B2C\u4E00\u6B21\u5173\u8054\uFF0C\u5219\u5F80\u5934\u8282\u70B9\u52A0\uFF0C\u5E76\u4E14\u5934\u5C3E\u8282\u70B9\u76F8\u540C\r\n   */\r\n  if (dep.subsTail) {\r\n    dep.subsTail.nextSub = newLink\r\n    newLink.prevSub = dep.subsTail\r\n    dep.subsTail = newLink\r\n  } else {\r\n    dep.subs = newLink\r\n    dep.subsTail = newLink\r\n  }\r\n  // endregion\r\n\r\n  // region \u5C06\u5217\u8868\u8282\u70B9\u4E0E sub \u5EFA\u7ACB\u5173\u7CFB\uFF0C\u662F\u5355\u5411\u94FE\u8868\r\n  // \u5B9E\u73B0\u903B\u8F91\r\n  /**\r\n   * \u5173\u8054\u53CC\u5411\u94FE\u8868\u5173\u7CFB\uFF0C\u5206\u4E24\u79CD\u60C5\u51B5\r\n   * 1. \u5B58\u5728\u5C3E\u8282\u70B9\uFF0C\u5F80\u5C3E\u8282\u70B9\u540E\u9762\u52A0\r\n   * 2. \u4E0D\u5B58\u5728\u4E3A\u8282\u70B9\uFF0C\u5219\u8868\u793A\u7B2C\u4E00\u6B21\u5173\u8054\uFF0C\u5219\u5F80\u5934\u8282\u70B9\u52A0\uFF0C\u5E76\u4E14\u5934\u5C3E\u8282\u70B9\u76F8\u540C\r\n   */\r\n  if (sub.depsTail) {\r\n    sub.depsTail.nextDep = newLink\r\n    sub.depsTail = newLink\r\n  } else {\r\n    sub.deps = newLink\r\n    sub.depsTail = newLink\r\n  }\r\n\r\n  // endregion\r\n}\r\n\r\n/**\r\n * \u66F4\u65B0\u6240\u6709\u5173\u8054 effect \u7684\u51FD\u6570(\u4F20\u64AD\u66F4\u65B0\u51FD\u6570)\r\n * @param subs \u4F20\u5165\u4E00\u4E2A\u5934\u90E8\u8282\u70B9\uFF0C\u7136\u540E\u4F9D\u6B21\u89E6\u53D1\u4E0B\u53BB\r\n */\r\nexport function propagate(subs) {\r\n  // \u901A\u77E5 effect \u6267\u884C\uFF0C\u4ECE\u800C\u83B7\u53D6\u6700\u65B0\u7684\u503C\r\n  let link = subs\r\n  let queuedEffect = []\r\n  while (link) {\r\n    const sub = link.sub\r\n    if (!sub.tracking && !sub.dirty) {\r\n      //\u8BA1\u7B97\u5C5E\u6027\u6807\u8BB0\u4E3A\u810F\r\n      sub.dirty = true\r\n      if ('update' in sub) {\r\n        processComputedUpdate(sub)\r\n      } else {\r\n        queuedEffect.push(link.sub)\r\n      }\r\n    }\r\n    link = link.nextSub\r\n  }\r\n  queuedEffect.forEach(effect => effect.notify())\r\n}\r\n\r\n/**\r\n * \u5F00\u59CB\u8FFD\u8E2A\u4F9D\u8D56\uFF0C\u5C06 depsTail \u5C3E\u8282\u70B9\u8BBE\u7F6E\u4E3A undefined\r\n * @param sub \u5F53\u524D effect \u51FD\u6570\u7684 this\r\n */\r\nexport function startTrack(sub) {\r\n  sub.tracking = true\r\n  sub.depsTail = undefined\r\n}\r\n\r\n/**\r\n * \u7ED3\u675F\u8FFD\u8E2A\uFF0C\u627E\u5230\u9700\u8981\u6E05\u7406\u7684\u4F9D\u8D56\uFF0C\u901A\u8FC7\u8C03\u7528 clearTracking \u8FDB\u884C\u4F9D\u8D56\u6E05\u7406\uFF0C\u65AD\u5F00\u5173\u8054\u5173\u7CFB\r\n * @param this \u5F53\u524D effect \u51FD\u6570\u7684 this\r\n */\r\nexport function endTrack(sub) {\r\n  sub.tracking = false\r\n  const depsTail = sub.depsTail\r\n\r\n  // \u8FFD\u8E2A\u5B8C\u4E86\uFF0C\u4E0D\u810F\u4E86\r\n  sub.dirty = false\r\n  /**\r\n   * \u9700\u8981\u6E05\u9664\u7684\u51E0\u79CD\u60C5\u51B5\r\n   * - 1. depsTail \u6709\uFF0C\u540C\u65F6 depsTail \u5185\u6709 nextDep \uFF0C\u9700\u8981\u5C06\u4F9D\u8D56\u6E05\u9664\r\n   * - 2. depsTail \u6CA1\u6709\uFF0C\u5E76\u4E14\u5934\u8282\u70B9\u6709\uFF0C\u5219\u628A\u6240\u6709\u4F9D\u8D56\u6E05\u9664\r\n   */\r\n  if (depsTail) {\r\n    if (depsTail.nextDep) {\r\n      clearTracking(depsTail.nextDep)\r\n      depsTail.nextDep = undefined\r\n    }\r\n  } else if (sub.deps) {\r\n    clearTracking(sub.deps)\r\n    sub.deps = undefined\r\n  }\r\n}\r\n\r\n/**\r\n * \u6E05\u7406\u65E0\u5173\u4F9D\u8D56\u7684\u51FD\u6570\r\n * @param link \u9700\u8981\u6E05\u7406\u7684\u4F9D\u8D56\u9879\u8282\u70B9\r\n */\r\nfunction clearTracking(link: Link) {\r\n  while (link) {\r\n    const { prevSub, nextSub, dep, nextDep } = link\r\n\r\n    // 1. \u5982\u679C\u4E0A\u4E00\u4E2A\u8282\u70B9(prevSub) \u6709\uFF0C\u90A3\u5C31\u628A prevSub \u7684 nextSub \u8BBE\u7F6E\u4E3A\u5F53\u524D\u8282\u70B9\u7684 nextSub\r\n    // 2. \u5982\u679C\u4E0A\u4E00\u4E2A\u8282\u70B9(prevSub) \u6CA1\u6709, \u8BC1\u660E\u662F\u5934\u8282\u70B9\uFF0C\u5C31\u628A dep \u4E2D\u7684 subs \u53D8\u4E3A\u5F53\u524D\u7684 nextSub\uFF0C\u7136\u540E\u628A nextSub \u7684 prevSub \u8BBE\u7F6E\u4E3A\u7A7A\r\n    // 3. \u5982\u679C\u4E0B\u4E00\u4E2A\u8282\u70B9(nextSub) \u6709\uFF0C\u90A3\u5C31\u628A  nextSub \u7684 prevSub  \u8BBE\u7F6E\u4E3A\u5F53\u524D\u8282\u70B9\u7684 prevSub\r\n    // 4. \u5982\u679C\u4E0B\u4E00\u4E2A\u8282\u70B9(nextSub) \u6CA1\u6709, \u8BC1\u660E\u662F\u5C3E\u8282\u70B9\uFF0C\u5C31\u628A dep \u4E2D\u7684 subsTail \u8BBE\u7F6E\u4E3A\u5F53\u524D\u8282\u70B9\u7684 prevSub, \u7136\u540E\u628A prevSub \u8BBE\u7F6E\u4E3A\u7A7A\r\n\r\n    // \u5224\u65AD\u4E0A\u4E00\u4E2A\u8282\u70B9\r\n    if (prevSub) {\r\n      prevSub.nextSub = nextSub\r\n      link.nextSub = undefined\r\n    } else {\r\n      dep.subs = nextSub\r\n    }\r\n\r\n    // \u5224\u65AD\u4E0B\u4E00\u4E2A\u8282\u70B9\r\n    if (nextSub) {\r\n      nextSub.prevSub = prevSub\r\n      link.prevSub = undefined\r\n    } else {\r\n      dep.subsTail = prevSub\r\n    }\r\n\r\n    link.dep = link.sub = undefined\r\n\r\n    // \u628A\u4E0D\u8981\u7684\u8282\u70B9\u7ED9 linkPool \uFF0C\u8BA9\u5B83\u80FD\u591F\u590D\u7528\r\n    link.nextDep = linkPool\r\n    linkPool = link\r\n\r\n    link = nextDep\r\n  }\r\n}\r\n\r\n/**\r\n * \u7528\u6765\u5904\u7406\u5F53\u89E6\u53D1\u66F4\u65B0\u65F6\uFF0C\u5F53\u524D\u51FD\u6570\u4E3A computed \u51FD\u6570\u9047\u5230\u7684\u95EE\u9898\r\n * @param sub \u5904\u7406\u89E6\u53D1\u66F4\u65B0\u65F6\u4E3A computed \u7684\u89E6\u53D1\u51FD\u6570\r\n */\r\nfunction processComputedUpdate(sub) {\r\n  /**\r\n   * \u66F4\u65B0\u8BA1\u7B97\u5C5E\u6027\r\n   *  - 1. \u8C03\u7528 update\r\n   *  - 2. \u901A\u77E5 subs \u94FE\u8868\u4E0A\u6240\u6709\u7684 sub \u91CD\u65B0\u6267\u884C\r\n   */\r\n  if (sub.subs && sub.update()) {\r\n    // sub.update() \u4F1A\u8FD4\u56DE\u4E00\u4E2A\u503C\uFF0C\u4F46\u503C\u4E3A true \u5219\u8868\u793A\u5F53\u524D\u503C\u53D1\u751F\u53D8\u5316\r\n    propagate(sub.subs)\r\n  }\r\n}\r\n", "import { Link, startTrack, endTrack, Sub } from './system'\r\n// \u7528\u6765\u4FDD\u5B58\u5F53\u524D\u6267\u884C\u7684 effect\r\nexport let activeSub\r\n\r\nexport function setActiveSub(sub) {\r\n  activeSub = sub\r\n}\r\n\r\nexport class ReactiveEffect implements Sub {\r\n  // \u4F9D\u8D56\u94FE\u8868\u7684\u5934\u8282\u70B9\r\n  deps: Link | undefined\r\n\r\n  // \u4F9D\u8D56\u94FE\u8868\u7684\u5C3E\u8282\u70B9\r\n  depsTail: Link | undefined\r\n\r\n  // tracking \u7528\u4E8E\u5224\u65AD\u662F\u5426\u5DF2\u7ECF\u8FFD\u8E2A\r\n  tracking = false\r\n\r\n  // \u5904\u7406\u4E00\u4E2A effect \u5185\u5BF9\u540C\u4E2A ref \u8FDB\u884C\u591A\u6B21\u6536\u96C6\u7684\u903B\u8F91\r\n  // - Vue \u6E90\u7801\u91C7\u53D6\u904D\u5386\u7684\u65B9\u6CD5\uFF0C\u67E5\u770B dep \u94FE\u6761\u4E2D\u662F\u5426\u5B58\u5728 sub\r\n  // - \u672C\u5185\u5BB9\u91C7\u53D6\u7A7A\u95F4\u6362\u65F6\u95F4\u7684\u65B9\u6CD5\uFF0C\u901A\u8FC7\u4E00\u4E2A dirty \u786E\u5B9A\u662F\u5426\u9700\u8981\u6536\u96C6\r\n  dirty = false\r\n\r\n  constructor(public fn) {}\r\n\r\n  /**\r\n   * \u7528\u6765\u6267\u884C\u54CD\u5E94\u5F0F\u65B9\u6CD5\r\n   * @returns \u6267\u884C\u5F53\u524D\u7684 \u54CD\u5E94\u5F0F\u65B9\u6CD5\r\n   */\r\n  run() {\r\n    if (!this.active) {\r\n      return this.fn()\r\n    }\r\n    // \u5148\u5C06\u5F53\u524D\u7684  effect \u4FDD\u5B58\u8D77\u6765\uFF0C\u4ECE\u800C\u5904\u7406\u5D4C\u5957\u7684\u903B\u8F91\u3002\u5B58\u5728 effect \u5219\u4FDD\u5B58\uFF0C\u4E0D\u5B58\u5728\u5219\u4E3A undefined\r\n    const prevSub = activeSub\r\n\r\n    // \u6BCF\u6B21\u6267\u884C fn \u4E4B\u524D\u628A this \u5B58\u50A8\u5230 activeSub \u4E2D\uFF0C \u8FD9\u6837\u80FD\u591F\u4F7F\u540C\u4E00\u4E2A effect \u5185\u7684\u4F9D\u8D56\u6536\u96C6\u51FD\u6570\u4E2D\u7684 activeSub(sub) \u4E3A\u540C\u4E00\u4E2A\uFF0C\u4F7F\u5F97\u4ED6\u4EEC\u7684 deps \u548C depsTail \u80FD\u591F\u4E3A\u540C\u4E00\u4E2A\r\n    setActiveSub(this)\r\n    // \u6BCF\u6B21\u91CD\u65B0\u6267\u884C effect \u65F6\u9700\u8981\u5C06 depsTail \u8BBE\u7F6E\u4E3A undefined \u4ECE\u800C\u4F7F\u5F97 effect \u4F1A\u4ECE\u5934\u8282\u70B9\u5F00\u59CB\u6267\u884C\u51FD\u6570\r\n    startTrack(this)\r\n\r\n    try {\r\n      return this.fn()\r\n    } finally {\r\n      // \u6267\u884C\u5B8C\u6210\u540E\uFF0C\u9700\u8981\u5224\u65AD\u5F53\u524D depsTail \u662F\u5426\u5177\u6709 nextDep \uFF0C\u8FD9\u4E9B nextDep \u90FD\u662F\u9700\u8981\u6E05\u7406\u7684\u5185\u5BB9\uFF0C\u56E0\u4E3A\u4ED6\u5DF2\u7ECF\u4E0D\u6EE1\u8DB3\u65B0\u7684 effect \u51FD\u6570\r\n      endTrack(this)\r\n\r\n      // \u6267\u884C\u5B8C\u6210\u540E \u628A  activeSub \u6062\u590D\u4E3A\u4E4B\u524D\u7684 effects\r\n      setActiveSub(prevSub)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \u901A\u77E5\u66F4\u65B0\uFF0C\u5982\u679C\u4F9D\u8D56\u7684\u6570\u636E\u53D1\u751F\u4E86\u53D8\u5316\uFF0C\u4F1A\u8C03\u7528\u8FD9\u4E2A\u51FD\u6570\r\n   */\r\n  notify() {\r\n    this.scheduler()\r\n  }\r\n\r\n  /**\r\n   * \u9ED8\u8BA4\u8C03\u7528 run \uFF0C\u5982\u679C\u7528\u6237\u4F20\u4E86 scheduler \u5219\u8C03\u7528\u7528\u6237\u4F20\u5165\u7684 scheduler \u65B9\u6CD5\uFF0C \u7C7B\u4F3C\u539F\u578B\u65B9\u6CD5\u4E0E\u5B9E\u4F8B\u65B9\u6CD5\r\n   */\r\n  scheduler() {\r\n    this.run()\r\n  }\r\n\r\n  // effect \u6FC0\u6D3B\u6807\u8BB0\uFF0C\u9ED8\u8BA4\u4E3A true\r\n  active = true\r\n\r\n  stop() {\r\n    if (this.active) {\r\n      // \u6E05\u7406\u4F9D\u8D56\r\n      startTrack(this)\r\n\r\n      endTrack(this)\r\n\r\n      // \u5C06 effct \u7684\u6FC0\u6D3B\u6807\u8BB0\u5173\u95ED\r\n      this.active = false\r\n    }\r\n  }\r\n}\r\n\r\nexport function effect(fn, options) {\r\n  const e = new ReactiveEffect(fn)\r\n\r\n  // scheduler \u89E6\u53D1\u66F4\u65B0\u7684\u914D\u7F6E\r\n  Object.assign(e, options)\r\n\r\n  e.run()\r\n\r\n  /**\r\n   * \u7ED1\u5B9A\u51FD\u6570\u7684 this\r\n   * P1: e.run.bind(e)\r\n   * P2: () => e.run()\r\n   */\r\n  const runner = e.run.bind(e)\r\n\r\n  // \u628A effect \u5B9E\u4F8B\u653E\u5230\u51FD\u6570\u91CC\uFF0C\u7136\u540E\u8FD4\u56DE\u7ED9\u5916\u90E8\r\n  runner.effect = e\r\n\r\n  return runner\r\n}\r\n", "import { type Link, link, propagate } from './system'\r\nimport { activeSub } from './effect'\r\n\r\nconst targetMap = new WeakMap()\r\n\r\nexport function track(target, key) {\r\n  if (!activeSub) {\r\n    return\r\n  }\r\n\r\n  /**\u627E depsMap \uFF0C\u627E\u5230\u5F53\u524D\u7684 target \u5BF9\u5E94\u7684 map\r\n   *\r\n   * depsMap = {\r\n   *    a: Dep,\r\n   *    b: Dep\r\n   * }\r\n   * */\r\n  let depsMap = targetMap.get(target)\r\n\r\n  if (!depsMap) {\r\n    // \u6CA1\u6709 depsMap , \u610F\u5473\u7740\u4E4B\u524D\u6CA1\u6709\u6536\u96C6\u8FC7\u8FD9\u4E2A target \u5BF9\u8C61\u91CC\u7684\u4EFB\u4F55 key\uFF0C\u56E0\u6B64\u9700\u8981\u521B\u5EFA\u4E00\u4E2A\u65B0\u7684 map\uFF0C\u6765\u4FDD\u5B58 target \u548C depsMap \u4E4B\u95F4\u7684\u5173\u8054\u5173\u7CFB\r\n    depsMap = new Map()\r\n    targetMap.set(target, depsMap)\r\n  }\r\n\r\n  // \u627E\u5230 key \u76F8\u5173\u8054\u7684 dep\r\n  let dep = depsMap.get(key)\r\n\r\n  if (!dep) {\r\n    // \u7B2C\u4E00\u6B21\u6536\u96C6\u8FD9\u4E2A\u5BF9\u8C61\uFF0C\u5219\u9700\u8981\u521B\u5EFA\u4E00\u4E2A dep \u91CC\u9762\u6709 subs \u548C subsTail\uFF0C\u7136\u540E\u4FDD\u5B58\u5230 depsMap \u4E2D\r\n    dep = new Dep()\r\n    depsMap.set(key, dep)\r\n  }\r\n\r\n  // \u7ED1\u5B9A dep \u548C activeSub \u7684\u5173\u7CFB\r\n  link(dep, activeSub)\r\n}\r\n\r\nexport function trigger(target, key) {\r\n  const depsMap = targetMap.get(target)\r\n\r\n  /**\u627E depsMap \uFF0C\u627E\u5230\u5F53\u524D\u7684 target \u5BF9\u5E94\u7684 map\r\n   *\r\n   * depsMap = {\r\n   *    a: Dep,\r\n   *    b: Dep\r\n   * }\r\n   * */\r\n  if (!depsMap) {\r\n    // depsMap \u6CA1\u6709\uFF0C\u8868\u793A\u8FD9\u4E2A\u5BF9\u8C61\u6CA1\u6709\u4EFB\u4F55\u5C5E\u6027\u5728 sub \u4E2D\u8BBF\u95EE\uFF0C\u610F\u5473\u7740\u4E0D\u9700\u8981\u8FDB\u884C\u66F4\u65B0\r\n    return\r\n  }\r\n\r\n  const targetIsArray = Array.isArray(target)\r\n\r\n  if (targetIsArray && key === 'length') {\r\n    /**\u66F4\u65B0\u6570\u7EC4\u7684 length\r\n     * \u66F4\u65B0\u524D state.length = 4 ==> ['a', 'b', 'c', 'd']\r\n     * \u66F4\u65B0\u540E state.length = 2 ==> ['a', 'b']\r\n     * \u6B64\u65F6\u9700\u8981\u901A\u77E5\u7ED1\u5B9A\u4E86 c \u548C d \u7684 effect \u91CD\u65B0\u6267\u884C\uFF0C\u4E5F\u5C31\u662F\u90A3\u4E9B\u7D22\u5F15\u5927\u4E8E\u7B49\u4E8E length \u7684\u5185\u5BB9\r\n     *\r\n     * depsMap = {\r\n     *  0: dep,\r\n     *  1: dep,\r\n     *  2: dep,\r\n     *  3: dep,\r\n     *  length: dep\r\n     * }\r\n     */\r\n    const length = target.length\r\n    depsMap.forEach((dep, depKey) => {\r\n      if (depKey >= length || depKey === 'length') {\r\n        // \u901A\u77E5\u8BBF\u95EE\u4E86\u5927\u4E8E\u7B49\u4E8E length \u7684 subs \u91CD\u65B0\u6267\u884C\u6536\u96C6\uFF0C\u4ECE\u800C\u6E05\u7A7A\u4F9D\u8D56\r\n        // \u5F53\u8BBF\u95EE\u7684\u662F length \u4E5F\u9700\u8981\u5C06 length \u76F8\u5173\u7684 sub \u91CD\u65B0\u6267\u884C\r\n        propagate(dep.subs)\r\n      }\r\n    })\r\n  } else {\r\n    // \u4E0D\u662F\u6570\u7EC4\uFF0C\u6216\u8005\u6570\u7EC4\u66F4\u65B0\u7684\u4E0D\u662F length\uFF0C\u5219\u76F4\u63A5\u6267\u884C\u4EE5\u4E0B\u5185\u5BB9\r\n\r\n    // \u627E\u5230 key \u76F8\u5173\u8054\u7684 dep\r\n    const dep = depsMap.get(key)\r\n\r\n    if (!dep) {\r\n      // dep \u6CA1\u6709\uFF0C\u8868\u793A\u8FD9\u4E2A key \u6CA1\u6709\u5728 sub \u4E2D\u8BBF\u95EE\u3002\u5219\u76F4\u63A5 return \uFF0C\u4E0D\u9700\u8981\u89E6\u53D1\u66F4\u65B0\r\n      return\r\n    }\r\n\r\n    // \u627E\u5230 dep.subs \u901A\u77E5\u4ED6\u4EEC\u91CD\u65B0\u6267\u884C\r\n    propagate(dep.subs)\r\n  }\r\n}\r\n\r\nclass Dep {\r\n  // \u8BA2\u9605\u8005\u94FE\u8868\u7684\u5934\u8282\u70B9\uFF0C\u7406\u89E3\u4E3A\u94FE\u8868\u4E2D\u7684 head\r\n  subs: Link\r\n\r\n  // \u8BA2\u9605\u8005\u94FE\u8868\u7684\u5C3E\u8282\u70B9\uFF0C\u7406\u89E3\u4E3A\u94FE\u8868\u4E2D\u7684 tail\r\n  subsTail: Link\r\n}\r\n", "import { track, trigger } from './dep'\r\nimport { isRef } from './ref'\r\nimport { hasChanged, isObject } from '@vue/shared'\r\nimport { reactive } from './reavtive'\r\n\r\nexport const mutableHandlers = {\r\n  /**\r\n   * \u6536\u96C6\u4F9D\u8D56\uFF0C \u7ED1\u5B9A target \u4E2D\u7684\u67D0\u4E00\u4E2A key \u548C sub \u4E4B\u95F4\u7684\u5173\u7CFB\r\n   *\r\n   * @param target target = {a:0}\r\n   * @param key  target \u4E2D\u5BF9\u5E94\u7684 key\u503C a\r\n   * @param receiver\r\n   * @returns\r\n   */\r\n  get(target, key, receiver) {\r\n    track(target, key)\r\n\r\n    const res = Reflect.get(target, key, receiver)\r\n\r\n    if (isRef(res)) {\r\n      // \u5982\u679C target \u662F\u4E00\u4E2A ref \uFF0C\u5C31\u76F4\u63A5\u628A\u503C\u7ED9\u5B83\uFF0C\u4E0D\u8981\u5728\u7EE7\u7EED .value\r\n      // target = { a: ref(0)}\r\n      return res.value\r\n    }\r\n\r\n    if (isObject(res)) {\r\n      // \u5982\u679C res \u662F\u4E00\u4E2A\u5BF9\u8C61\u5219\u7EE7\u7EED\u5305\u88C5\u6210 reactive\r\n      return reactive(res)\r\n    }\r\n\r\n    // receiver \u7528\u6765\u4FDD\u8BC1\u8BBF\u95EE\u5668\u91CC\u9762\u7684 this \u6267\u884C\u4EE3\u7406\u5BF9\u8C61 proxy\r\n    return res\r\n  },\r\n\r\n  /**\r\n   * \u89E6\u53D1\u66F4\u65B0, set \u7684\u65F6\u5019\uFF0C\u901A\u77E5\u5DF2\u7ECF\u6536\u96C6\u5B8C\u7684\u76F8\u5BF9\u5E94\u7684\u4F9D\u8D56\u91CD\u65B0\u6267\u884C\r\n   *\r\n   * @param target \u5BF9\u8C61 target = { a: 0}\r\n   * @param key \u952E\u540D a\r\n   * @param newValue \u4FEE\u6539\u7684\u503C\r\n   * @param receiver\r\n   */\r\n  set(target, key, newValue, receiver) {\r\n    // \u62FF\u5230\u66F4\u65B0\u524D\u7684\u503C\r\n    const oldValue = target[key]\r\n\r\n    //\u62FF\u5230\u66F4\u65B0\u7684 length\r\n    const targetIsArray = Array.isArray(target)\r\n    const oldLength = targetIsArray ? target.length : 0\r\n\r\n    // \u5982\u679C\u66F4\u65B0 reactive \u91CC\u9762 a \u7684\u503C\u4E4B\u524D\u662F\u4E2A ref \uFF0C\u4E14\u65B0\u7684 ref \u4E0D\u662F\u4E00\u4E2A ref \u3002\u5219\u9700\u8981\u540C\u6B65\u4FEE\u6539 \u59CB a \u7684 ref \u7684\u503C\u4E3A newValue\r\n    // \u5982\u679C\u66F4\u65B0\u7684 newValue \u662F\u4E00\u4E2A ref \uFF0C\u90A3\u5C31\u4E0D\u9700\u8981\u540C\u6B65\u66F4\u65B0\r\n    if (isRef(oldValue) && !isRef(newValue)) {\r\n      /**\r\n       * const a = ref(0)\r\n       * target = { a}\r\n       *\r\n       * target.a = 1 \u5C31\u53EF\u4EE5\u770B\u4F5C a.value = 1\r\n       * a.value = 1\r\n       */\r\n      oldValue.value = newValue\r\n      return true\r\n    }\r\n\r\n    // \u5148\u901A\u77E5 set \u5728 \u89E6\u53D1\u66F4\u65B0\r\n    const res = Reflect.set(target, key, newValue, receiver)\r\n\r\n    // \u5224\u65AD\u66F4\u6539\u524D\u540E\u7684\u503C\u662F\u5426\u76F8\u540C\uFF0C\u76F8\u540C\u5219\u4E0D\u5904\u7406\uFF0C\u4E0D\u76F8\u540C\u5219\u89E6\u53D1\u66F4\u65B0\r\n    if (hasChanged(newValue, oldValue)) {\r\n      trigger(target, key)\r\n    }\r\n\r\n    // \u62FF\u5230\u66F4\u65B0\u540E\u7684\u503C\r\n    const newLength = targetIsArray ? target.length : 0\r\n\r\n    //  \u5904\u7406\u9690\u5F0F\u66F4\u65B0\u6570\u7EC4\u7684 length\r\n    if (targetIsArray && newLength !== oldLength && key !== 'length') {\r\n      /**\r\n       * \u9690\u5F0F\u66F4\u65B0 length \uFF0C\u4F8B\u5982 push\u3001 pop\u7B49\r\n       * \u66F4\u65B0\u524D state.length = 4 ==> ['a', 'b', 'c', 'd']\r\n       * \u66F4\u65B0\u540E state.length = 5 ==> ['a', 'b', 'c', 'd', 'e']\r\n       * \u66F4\u65B0\u52A8\u4F5C\uFF0C\u4EE5 push \u4E3A\u4F8B\uFF0C\u8FFD\u52A0\u4E86\u4E00\u4E2A e\r\n       * \u9690\u5F0F\u66F4\u65B0\u7684\u65B9\u6CD5: push pop shift unshift\r\n       * \u901A\u8FC7\u5BF9\u6BD4\u4E00\u4E2A\u66F4\u65B0\u524D\u4E0E\u4E00\u4E2A\u66F4\u65B0\u540E\u7684 length \u6765\u5224\u65AD\u662F\u5426\u6709\u9690\u5F0F\u66F4\u65B0\r\n       * */\r\n      trigger(target, 'length')\r\n    }\r\n\r\n    return res\r\n  },\r\n}\r\n", "import { isObject } from '@vue/shared'\r\nimport { mutableHandlers } from './baseHandlers'\r\n\r\nexport function reactive(target) {\r\n  return createReactiveObject(target)\r\n}\r\n\r\n/** \u4FDD\u5B58 target \u548C \u54CD\u5E94\u5F0F\u5BF9\u8C61\u4E4B\u95F4\u7684\u5173\u8054\u5173\u7CFB\uFF0C\u4ECE\u800C\u9632\u6B62\u540C\u4E00\u4E2A\u4EE3\u7406\u5BF9\u8C61\u88AB\u591A\u6B21\u521B\u5EFA\r\n *\r\n *  target => proxy\r\n * */\r\nconst reactiveMap = new WeakMap()\r\n\r\n/**\r\n * \u4FDD\u5B58\u6240\u6709\u4F7F\u7528 reactive \u521B\u5EFA\u51FA\u6765\u7684\u54CD\u5E94\u5F0F\u5BF9\u8C61\r\n */\r\nconst reactiveSet = new WeakSet()\r\n\r\nexport function createReactiveObject(target) {\r\n  // reactive \u5FC5\u987B\u8981\u63A5\u53D7\u4E00\u4E2A\u5BF9\u8C61\r\n  if (!isObject(target)) {\r\n    // target \u4E0D\u662F\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u5219\u8FD4\u56DE\u53BB\r\n    return target\r\n  }\r\n\r\n  // \u5224\u65AD\u5F53\u524D target \u662F\u5426\u5DF2\u7ECF\u662F\u54CD\u5E94\u5F0F\u5BF9\u8C61\r\n  if (reactiveSet.has(target)) {\r\n    return target\r\n  }\r\n\r\n  // \u67E5\u770B\u4E4B\u524D\u8FD9\u4E2A target \u662F\u5426\u6709\u4EE3\u7406\u5BF9\u8C61\r\n  const exisitingProxy = reactiveMap.get(target)\r\n\r\n  // \u5982\u679C\u8FD9\u4E2A target \u4E4B\u524D\u521B\u5EFA\u8FC7 proxy \uFF0C\u5219\u76F4\u63A5\u8FD4\u56DE\u5B58\u5728\u7684\u54CD\u5E94\u5F0F\u5BF9\u8C61\r\n  if (exisitingProxy) {\r\n    return exisitingProxy\r\n  }\r\n\r\n  /**\r\n   * \u521B\u5EFA target \u7684\u4EE3\u7406\u5BF9\u8C61\r\n   */\r\n  const proxy = new Proxy(target, mutableHandlers)\r\n\r\n  // \u5C06\u4E00\u4E2A target \u5BF9\u8C61\u4E0E\u5979\u76F8\u5173\u8054\u7684\u4EE3\u7406\u5BF9\u8C61\u8FDB\u884C\u5173\u8054\r\n  reactiveMap.set(target, proxy)\r\n\r\n  // \u4FDD\u5B58\u5DF2\u7ECF\u521B\u5EFA\u8FC7\u7684\u54CD\u5E94\u5F0F\u5BF9\u8C61\r\n  reactiveSet.add(proxy)\r\n\r\n  return proxy\r\n}\r\n\r\n/**\r\n * \u7ED1\u5B9A target \u7684 key \u5173\u8054\u7684\u6240\u6709\u7684 dep\r\n * obj = { a:0, b:1 }\r\n *\r\n * targetMap = {\r\n *  [obj]: {\r\n *      a: Dep\r\n *      b: Dep\r\n *  }\r\n * }\r\n * */\r\n\r\n/**\r\n * \u5224\u65AD target \u662F\u4E0D\u662F\u54CD\u5E94\u5F0F\u5BF9\u8C61\uFF0C\u53EA\u8981\u5728 reactiveSet \u4E2D\u5C31\u662F\u54CD\u5E94\u5F0F\u5BF9\u8C61\uFF0C\u539F\u7248\u7684\u903B\u8F91\u662F\u4E0E isRef \u7C7B\u4F3C\uFF0C\u5728 ref \u4E2D\u5EFA\u7ACB\u53D8\u91CF\uFF0C\u7136\u540E\u5728 reactive \u4E2D\u5224\u65AD\u4E0E\u8BBE\u7F6E\r\n * @param target\r\n * @returns\r\n */\r\nexport function isReactive(target) {\r\n  return reactiveSet.has(target)\r\n}\r\n", "import { hasChanged, isObject } from '@vue/shared'\r\nimport { activeSub, ReactiveEffect } from './effect'\r\nimport { Dependency, link, propagate, Link } from './system'\r\nimport { reactive, isReactive } from './reavtive'\r\n\r\nexport enum ReactiveFlags {\r\n  IS_REF = '__v_isRef',\r\n}\r\n\r\n/**\r\n * ref \u7684\u7C7B \u7528\u6765\u4FDD\u5B58\u503C\r\n */\r\nclass RefImpl implements Dependency {\r\n  // \u4FDD\u5B58\u5B9E\u9645\u7684\u503C\r\n  _value\r\n\r\n  // \u8BA2\u9605\u8005\u94FE\u8868\u7684\u5934\u8282\u70B9\uFF0C\u7406\u89E3\u4E3A\u94FE\u8868\u4E2D\u7684 head\r\n  subs: Link\r\n\r\n  // \u8BA2\u9605\u8005\u94FE\u8868\u7684\u5C3E\u8282\u70B9\uFF0C\u7406\u89E3\u4E3A\u94FE\u8868\u4E2D\u7684 tail\r\n  subsTail: Link;\r\n\r\n  // ref \u7684\u6807\u8BB0\uFF0C\u8BC1\u660E\u662F ref\r\n  [ReactiveFlags.IS_REF] = true\r\n\r\n  constructor(value) {\r\n    //  \u5982\u679C value \u662F\u4E00\u4E2A\u5BF9\u8C61\u5219\u4F7F\u7528 reactive \u8F6C\u6362\u4E3A\u54CD\u5E94\u5F0F\r\n    this._value = isObject(value) ? reactive(value) : value\r\n  }\r\n\r\n  get value() {\r\n    // \u6536\u96C6\u4F9D\u8D56\r\n    if (activeSub) {\r\n      trackRef(this)\r\n    }\r\n    return this._value\r\n  }\r\n\r\n  set value(newValue) {\r\n    // \u53EA\u6709\u503C\u53D1\u751F\u53D8\u5316\u624D\u89E6\u53D1\u66F4\u65B0\r\n    if (hasChanged(newValue, this._value)) {\r\n      // \u89E6\u53D1\u66F4\u65B0\r\n      // \u5982\u679C newValue \u662F\u4E00\u4E2A\u5BF9\u8C61\u5219\u4F7F\u7528 reactive \u8F6C\u6362\u4E3A\u54CD\u5E94\u5F0F\r\n      this._value = isObject(newValue) ? reactive(newValue) : newValue\r\n    }\r\n\r\n    triggerRef(this)\r\n  }\r\n}\r\n\r\n/**\r\n *  ref \u51FD\u6570\r\n */\r\nexport function ref(value) {\r\n  return new RefImpl(value)\r\n}\r\n\r\n/**\r\n * isref \u51FD\u6570\r\n * \u5224\u65AD\u662F\u5426\u4E3A ref\r\n */\r\nexport function isRef(value) {\r\n  return !!(value && value[ReactiveFlags.IS_REF])\r\n}\r\n\r\n/**\r\n * \u6536\u96C6 ref \u7684\u76F8\u5173\u4F9D\u8D56\uFF0C\u5E76\u4E14\u5EFA\u7ACB ref \u4E0E effect \u4E4B\u95F4\u7684\u94FE\u8868\u5173\u7CFB\r\n * @param dep\r\n */\r\nexport function trackRef(dep) {\r\n  if (activeSub) {\r\n    link(dep, activeSub)\r\n  }\r\n}\r\n\r\n/**\r\n * \u89E6\u53D1 ref \u5173\u8054\u7684 effect \u91CD\u65B0\u6267\u884C\r\n * @param dep\r\n */\r\nexport function triggerRef(dep) {\r\n  if (dep.subs) {\r\n    propagate(dep.subs)\r\n  }\r\n}\r\n\r\nclass ObjectRefImpl {\r\n  [ReactiveFlags.IS_REF] = true\r\n\r\n  constructor(\r\n    public _object,\r\n    public _key,\r\n  ) {}\r\n\r\n  get value() {\r\n    return this._object[this._key]\r\n  }\r\n\r\n  set value(newVal) {\r\n    this._object[this._key] = newVal\r\n  }\r\n}\r\n/**\r\n * \u5C06\u4E00\u4E2A\u5BF9\u8C61\u5185\u7684\u67D0\u4E2A\u503C\u5355\u72EC\u63D0\u53D6\u51FA\u6765\u4F5C\u4E3A\u54CD\u5E94\u5F0F\u6570\u636E\r\n * @param target \u5BF9\u8C61\r\n * @param key \u503C\r\n * @returns\r\n */\r\nexport function toRef(target, key) {\r\n  return new ObjectRefImpl(target, key)\r\n}\r\n\r\n/**\r\n * \u5C06\u4E00\u4E2A\u54CD\u5E94\u5F0F\u5BF9\u8C61\u91CC\u7684\u6240\u6709\u5C5E\u6027\u8F6C\u6362\u4E3A\u54CD\u5E94\u5F0F\u6570\u636E\uFF0C\u5E76\u653E\u5728\u4E00\u4E2A\u5BF9\u8C61\u4E2D\u7ED9\u7528\u6237\u63D0\u53D6\r\n * @param target \u8981\u4ECE\u4E2D\u63D0\u53D6\u7684\u5BF9\u8C61\r\n * @returns\r\n */\r\nexport function toRefs(target) {\r\n  if (!isReactive(target)) {\r\n    console.warn('\u4F20\u5165\u7684\u503C\uFF0C\u5FC5\u987B\u4E3A\u54CD\u5E94\u5F0F\u5BF9\u8C61')\r\n  }\r\n\r\n  const res = {}\r\n\r\n  for (const key in target) {\r\n    res[key] = new ObjectRefImpl(target, key)\r\n  }\r\n\r\n  // \u8FD4\u56DE\u4E00\u4E2A\u5177\u6709\u539F\u5148 target \u91CC\u9762\u7684\u6240\u6709\u503C\u7684\u5BF9\u8C61\u3002\u5E76\u4E14\u8BE5\u5BF9\u8C61\u7684\u6BCF\u4E2A\u503C\u90FD\u9700\u8981\u53D8\u4E3A ObjectRefImple\r\n  return res\r\n}\r\n\r\n/**\r\n * \u5982\u679C\u53C2\u6570\u662F ref\uFF0C\u5219\u8FD4\u56DE\u5185\u90E8\u503C\uFF0C\u5426\u5219\u8FD4\u56DE\u53C2\u6570\u672C\u8EAB\r\n * @param value\r\n * @returns\r\n */\r\nexport function unRef(value) {\r\n  return isRef(value) ? value.value : value\r\n}\r\n\r\n/**\r\n * \u8BA9\u8FD9\u4E2A\u54CD\u5E94\u5F0F\u5BF9\u8C61\u91CC\u9762\u7684\u503C\u4E0D\u9700\u8981\u518D\u901A\u8FC7 .value \u53BB\u8BFB\u53D6\r\n *\r\n * AS: state.a.value ==> state.a\r\n *\r\n * @param target\r\n * @returns\r\n */\r\nexport function proxyRefs(target) {\r\n  return new Proxy(target, {\r\n    get(target, key, receiver) {\r\n      /**\r\n       * \u81EA\u52A8\u89E3\u5305 ref\r\n       * \u5982\u679C target[key] \u662F\u4E00\u4E2A ref \u5219\u8FD4\u56DE ref.value \uFF0C\u5426\u5219\u8FD4\u56DE target[key]\r\n       */\r\n\r\n      const res = Reflect.get(target, key, receiver)\r\n\r\n      return unRef(res)\r\n    },\r\n    set(target, key, newValue, receiver) {\r\n      const oldValue = target[key]\r\n      // \u5982\u679C\u66F4\u65B0 reactive \u91CC\u9762 a \u7684\u503C\u4E4B\u524D\u662F\u4E2A ref \uFF0C\u4E14\u65B0\u7684 ref \u4E0D\u662F\u4E00\u4E2A ref \u3002\u5219\u9700\u8981\u540C\u6B65\u4FEE\u6539 \u59CB a \u7684 ref \u7684\u503C\u4E3A newValue\r\n      // \u5982\u679C\u66F4\u65B0\u7684 newValue \u662F\u4E00\u4E2A ref \uFF0C\u90A3\u5C31\u4E0D\u9700\u8981\u540C\u6B65\u66F4\u65B0\r\n      if (isRef(oldValue) && !isRef(newValue)) {\r\n        /**\r\n         * const a = ref(0)\r\n         * target = { a}\r\n         *\r\n         * target.a = 1 \u5C31\u53EF\u4EE5\u770B\u4F5C a.value = 1\r\n         * a.value = 1\r\n         */\r\n        oldValue.value = newValue\r\n        return true\r\n      }\r\n\r\n      return Reflect.set(target, key, newValue, receiver)\r\n    },\r\n  })\r\n}\r\n", "import { hasChanged, isFunction } from '@vue/shared'\r\nimport { ReactiveFlags } from './ref'\r\nimport { Link, Dependency, Sub, link, startTrack, endTrack } from './system'\r\nimport { activeSub, setActiveSub } from './effect'\r\n\r\nclass ComputedRefImpl implements Dependency, Sub {\r\n  // computed \u4E5F\u662F\u4E00\u4E2A ref \uFF0C\u901A\u8FC7 isRef \u4E5F\u8FD4\u56DE true\r\n  [ReactiveFlags.IS_REF] = true\r\n\r\n  // \u4FDD\u5B58 fn \u7684\u8FD4\u56DE\u503C\r\n  _value\r\n\r\n  //region \u4F5C\u4E3A dep,\u8981\u5173\u8054 subs \u5982\u679C\u503C\u53D1\u751F\u6539\u53D8\u5219\u901A\u77E5\u66F4\u65B0\r\n  // \u8BA2\u9605\u8005\u94FE\u8868\u7684\u5934\u8282\u70B9\uFF0C\u7406\u89E3\u4E3A\u94FE\u8868\u4E2D\u7684 head\r\n  subs: Link | undefined\r\n\r\n  // \u8BA2\u9605\u8005\u94FE\u8868\u7684\u5C3E\u8282\u70B9\uFF0C\u7406\u89E3\u4E3A\u94FE\u8868\u4E2D\u7684 tail\r\n  subsTail: Link | undefined\r\n  //endregion\r\n\r\n  //region  \u4F5C\u4E3A sub \uFF0C\u8981\u4FDD\u5B58\u88AB\u6211\u6536\u96C6\u7684 dep\r\n  // \u4F9D\u8D56\u94FE\u8868\u7684\u5934\u8282\u70B9\r\n  deps: Link | undefined\r\n\r\n  // \u4F9D\u8D56\u94FE\u8868\u7684\u5C3E\u8282\u70B9\r\n  depsTail: Link | undefined\r\n\r\n  // tracking \u7528\u4E8E\u5224\u65AD\u662F\u5426\u5DF2\u7ECF\u8FFD\u8E2A\r\n  tracking = false\r\n\r\n  //endregion\r\n\r\n  // \u8BA1\u7B97\u5C5E\u6027\u810F\u4E0D\u810F\uFF0C\u5982\u679C dirty \u4E3A true \u5219\u8BC1\u660E\u8BE5\u8BA1\u7B97\u662F\u810F\u7684, \u6240\u4EE5 get \u548C set \u7684\u65F6\u5019\uFF0C\u9700\u8981\u6267\u884C update\r\n  dirty = true\r\n\r\n  constructor(\r\n    public fn,\r\n    private setter,\r\n  ) {}\r\n\r\n  get value() {\r\n    if (this.dirty) {\r\n      //\u5982\u679C\u8BA1\u7B97\u5C5E\u6027\u810F\u4E86\u5219 update\r\n      this.update()\r\n    }\r\n    /**\r\n     * \u4F5C\u4E3A dep(ref) \uFF0C\u4E3A\u4E86\u5B9E\u73B0 dep \u529F\u80FD\uFF0C\u8981\u548C sub(effect) \u5173\u8054\u5173\u7CFB\r\n     */\r\n    if (activeSub) {\r\n      link(this, activeSub)\r\n    }\r\n\r\n    return this._value\r\n  }\r\n\r\n  set value(newValue) {\r\n    if (this.setter) {\r\n      this.setter(newValue)\r\n    } else {\r\n      console.warn('\u6211\u662F\u53EA\u8BFB\u7684\uFF0C\u65E0\u6CD5\u91CD\u65B0\u8D4B\u503C')\r\n    }\r\n  }\r\n\r\n  update() {\r\n    /** \u4F5C\u4E3A sub(effect) \u5B9E\u73B0 sub \u7684\u529F\u80FD\uFF0C\u4E3A\u4E86\u5728\u6267\u884C fn \u671F\u95F4\uFF0C\u6536\u96C6 fn \u6267\u884C\u8FC7\u7A0B\u4E2D\u8BBF\u95EE\u5230\u7684\u54CD\u5E94\u5F0F\u6570\u636E\r\n     * \u5EFA\u7ACB dep \u548C sub \u4E4B\u95F4\u7684\u5173\u8054\u5173\u7CFB\r\n     */\r\n    // \u5148\u5C06\u5F53\u524D\u7684 effect \u4FDD\u5B58\u8D77\u6765\uFF0C\u4ECE\u800C\u5904\u7406\u5D4C\u5957\u7684\u903B\u8F91\u3002\u5B58\u5728 effect \u5219\u4FDD\u5B58\uFF0C\u4E0D\u5B58\u5728\u5219\u4E3A undefined\r\n    const prevSub = activeSub\r\n\r\n    // \u6BCF\u6B21\u6267\u884C fn \u4E4B\u524D\u628A this \u5B58\u50A8\u5230 activeSub \u4E2D\uFF0C \u8FD9\u6837\u80FD\u591F\u4F7F\u540C\u4E00\u4E2A effect \u5185\u7684\u4F9D\u8D56\u6536\u96C6\u51FD\u6570\u4E2D\u7684 activeSub(sub) \u4E3A\u540C\u4E00\u4E2A\uFF0C\u4F7F\u5F97\u4ED6\u4EEC\u7684 deps \u548C depsTail \u80FD\u591F\u4E3A\u540C\u4E00\u4E2A\r\n    setActiveSub(this)\r\n\r\n    // \u6BCF\u6B21\u91CD\u65B0\u6267\u884C effect \u65F6\u9700\u8981\u5C06 depsTail \u8BBE\u7F6E\u4E3A undefined \u4ECE\u800C\u4F7F\u5F97 effect \u4F1A\u4ECE\u5934\u8282\u70B9\u5F00\u59CB\u6267\u884C\u51FD\u6570\r\n    startTrack(this)\r\n\r\n    try {\r\n      // \u62FF\u5230\u8001\u503C\r\n      const oldValue = this._value\r\n\r\n      // \u62FF\u5230\u65B0\u7684\u503C\r\n      this._value = this.fn()\r\n\r\n      // \u8FD4\u56DE\u503C\u6709\u6CA1\u6709\u53D8 \uFF0C\u503C\u53D1\u751F\u53D8\u5316\u5219\u8FD4\u56DE true\r\n      return hasChanged(this._value, oldValue)\r\n    } finally {\r\n      // \u6267\u884C\u5B8C\u6210\u540E\uFF0C\u9700\u8981\u5224\u65AD\u5F53\u524D depsTail \u662F\u5426\u5177\u6709 nextDep \uFF0C\u8FD9\u4E9B nextDep \u90FD\u662F\u9700\u8981\u6E05\u7406\u7684\u5185\u5BB9\uFF0C\u56E0\u4E3A\u4ED6\u5DF2\u7ECF\u4E0D\u6EE1\u8DB3\u65B0\u7684 effect \u51FD\u6570\r\n      endTrack(this)\r\n\r\n      // \u6267\u884C\u5B8C\u6210\u540E \u628A  activeSub \u6062\u590D\u4E3A\u4E4B\u524D\u7684 effects\r\n      setActiveSub(prevSub)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n *  \u8BA1\u7B97\u5C5E\u6027\r\n * @param getterOrOptions \u6709\u53EF\u80FD\u4E3A\u51FD\u6570\uFF0C\u4E5F\u6709\u53EF\u80FD\u4E3A\u5BF9\u8C61\uFF0C\u5BF9\u8C61\u91CC\u9762\u5177\u6709 get \u548C set \u5C5E\u6027\r\n */\r\nexport function computed(getterOrOptions) {\r\n  let getter\r\n  let setter\r\n\r\n  if (isFunction(getterOrOptions)) {\r\n    /**\r\n     * const c = computed(()=>{})\r\n     */\r\n    getter = getterOrOptions\r\n  } else {\r\n    /**\r\n     * const c = computed({\r\n     *      get(){},\r\n     *      set(){}\r\n     * })\r\n     */\r\n    getter = getterOrOptions.get\r\n    setter = getterOrOptions.set\r\n  }\r\n\r\n  return new ComputedRefImpl(getter, setter)\r\n}\r\n", "import { isRef } from './ref'\r\nimport { ReactiveEffect } from './effect'\r\nimport { isFunction, isObject } from '@vue/shared'\r\nimport { isReactive } from './reavtive'\r\n\r\n/**\r\n *\r\n * @param source \u8981\u76D1\u542C\u7684\u76F8\u5E94\u5185\u5BB9\r\n * @param cb \u89E6\u53D1\u7684\u56DE\u8C03\u51FD\u6570,\u5177\u6709 newValue \u548C oldValue\r\n * @param options \u76F8\u5E94\u7684\u76D1\u542C\u8BBE\u7F6E\uFF0C\u4F8B\u5982: \u4EC5\u89E6\u53D1\u4E00\u6B21\u3001\u7ACB\u5373\u89E6\u53D1 \u7B49\r\n * @returns\r\n */\r\nexport function watch(source, cb, options) {\r\n  let getter\r\n\r\n  let { immediate, once, deep } = options || {}\r\n\r\n  if (once) {\r\n    // \u5982\u679C once \u4F20\u4E86\uFF0C\u90A3\u5C31\u628A cb \u6539\u4E3A\u539F\u6765\u7684 cb \u52A0\u4E0A stop \u505C\u6B62\u76D1\u542C\r\n    const _cb = cb\r\n\r\n    cb = (...args) => {\r\n      _cb(...args)\r\n      stop()\r\n    }\r\n  }\r\n\r\n  if (isRef(source)) {\r\n    // \u5982\u679C\u503C\u4E3A ref \u5219\u8BBF\u95EE source.value \u4ECE\u800C\u6536\u96C6\u4F9D\u8D56\r\n    getter = () => source.value\r\n  } else if (isReactive(source)) {\r\n    // \u5982\u679C\u503C\u662F reactive \uFF0C\u5219\u9ED8\u8BA4 deep \u4E3A true\uFF0C\u5982\u679C deep \u4F20\u5165\u503C\uFF0C\u5219\u4EE5\u4F20\u5165\u7684\u4E3A\u4E3B\r\n    getter = () => source\r\n    if (!deep) {\r\n      deep = true\r\n    }\r\n  } else if (isFunction(source)) {\r\n    // \u5982\u679C source \u662F\u4E00\u4E2A\u51FD\u6570\uFF0C\u90A3\u4E48 getter \u5C31\u7B49\u4E8E source\r\n    getter = source\r\n  }\r\n\r\n  if (deep) {\r\n    const baseGetter = getter\r\n    const depth = deep === true ? Infinity : deep\r\n\r\n    getter = () => traverse(baseGetter(), depth)\r\n  }\r\n\r\n  let oldValue\r\n\r\n  let cleanup = null\r\n\r\n  function onClaenup(cb) {\r\n    cleanup = cb\r\n  }\r\n\r\n  /**\r\n   * \u7528\u6765\u751F\u6210\u9700\u8981\u76D1\u542C\u7684 source \u7684\u51FD\u6570\uFF0C\u5E76\u4E14\u6536\u96C6\u76F8\u5E94\u7684\u4F9D\u8D56\r\n   *  - \u5982\u679C source \u4E3A ref \u5219 getter \u8FD4\u56DE\u4E00\u4E2A source.value\r\n   *  - \u5982\u679C source \u4E3A reactive \u5219 getter \u76F4\u63A5\u8FD4\u56DE\u5F53\u524D\u7684 source\uFF0C\u5E76\u4E14\u9700\u8981\u5224\u65AD\u662F\u5426\u5B58\u5728 deep\r\n   *  - \u5982\u679C source \u4E3A function \u5219 getter \u76F4\u63A5\u4E3A\u5F53\u524D\u7684 source \u51FD\u6570\uFF0C\u4E0D\u9700\u8981\u8FD4\u56DE\r\n   */\r\n  function job() {\r\n    //  \u770B\u4E00\u4E0B\u662F\u5426\u9700\u8981\u6E05\u7406\u4E0A\u4E00\u6B21\u7684\u526F\u4F5C\u7528\uFF0C\u5982\u679C\u6709\u5C31\u6267\u884C\uFF0C\u6267\u884C\u5B8C\u6210\u540E\u7F6E\u7A7A\r\n    if (cleanup) {\r\n      cleanup()\r\n      cleanup = null\r\n    }\r\n\r\n    // \u6267\u884C effect.run \u62FF\u5230 getter \u7684\u8FD4\u56DE\u503C\uFF0C\u4E0D\u80FD\u76F4\u63A5\u6267\u884C getter \uFF0C\u56E0\u4E3A\u9700\u8981\u6536\u96C6\u4F9D\u8D56\r\n    const newValue = effect.run()\r\n\r\n    // \u6267\u884C\u7528\u6237\u56DE\u8C03\uFF0C\u628A newValue \u3001 oldValue \u548C onClaenup \u51FD\u6570 \u4F20\u5165\r\n    cb(newValue, oldValue, onClaenup)\r\n\r\n    // \u4E0B\u4E00\u6B21\u7684 oldValue \u7B49\u4E8E\u8FD9\u4E00\u6B21\u7684 newValue\r\n    oldValue = newValue\r\n  }\r\n\r\n  const effect = new ReactiveEffect(getter)\r\n\r\n  effect.scheduler = job\r\n\r\n  if (immediate) {\r\n    // \u5982\u679C\u5B58\u5728 immediate \u5219\u76F4\u63A5\u8FDB\u884C\u89E6\u53D1\r\n    job()\r\n  } else {\r\n    // \u8FD9\u4E00\u6B65\u6709\u4E24\u4E2A\u76EE\u7684: 1. \u62FF\u5230 oldValue  2. \u6536\u96C6\u4F9D\u8D56\r\n    oldValue = effect.run()\r\n  }\r\n\r\n  // \u505C\u6B62\u76D1\u542C\r\n  function stop() {\r\n    effect.stop()\r\n  }\r\n\r\n  return stop\r\n}\r\n\r\n/**\r\n * \u7528\u6765\u5BF9\u54CD\u5E94\u5F0F\u5BF9\u8C61\u8FDB\u884C\u6DF1\u5EA6\u76D1\u542C\u7684\u51FD\u6570\r\n * @param value \u76D1\u542C\u7684\u503C\r\n * @param depth \u9700\u8981\u6DF1\u5EA6\u76D1\u542C\u7684\u5C42\u6B21\uFF0C\u9ED8\u8BA4\u4E3A\u65E0\u7A77\r\n * @param seen \u7528\u4E8E\u5B58\u50A8\u5DF2\u7ECF\u904D\u5386\u8FC7\u7684\u503C\r\n * @returns\r\n */\r\nfunction traverse(value, depth = Infinity, seen = new Set()) {\r\n  //\u5982\u679C\u4E0D\u662F\u4E00\u4E2A\u5BF9\u8C61\u6216\u8005\u76D1\u542C\u5C42\u7EA7\u5230 0 \u5219\u76F4\u63A5\u8FD4\u56DE value\r\n  if (!isObject(value) || depth <= 0) {\r\n    // \u4E0D\u662F\u5BF9\u8C61\u5219\u9012\u5F52\r\n    return value\r\n  }\r\n\r\n  // \u67E5\u770B\u662F\u5426\u5DF2\u7ECF\u904D\u5386\u8FC7\uFF0C\u9632\u6B62\u6808\u6EA2\u51FA\r\n  if (seen.has(value)) {\r\n    return value\r\n  }\r\n\r\n  // \u5C42\u7EA7\u9010\u6B65\u51CF 1\r\n  depth--\r\n\r\n  // \u6DFB\u52A0\u5230 seen \u4E2D\uFF0C\u4EE5\u4FBF\u5224\u65ADs\r\n  seen.add(value)\r\n\r\n  // \u662F\u5BF9\u8C61\u5219\u9012\u5F52\u5904\u7406\r\n  for (const key in value) {\r\n    traverse(value[key], depth, seen)\r\n\r\n    return value\r\n  }\r\n}\r\n"],
  "mappings": ";AAAO,SAAS,SAAS,OAAO;AAC9B,SAAO,OAAO,SAAS,YAAY,UAAU;AAC/C;AAQO,SAAS,WAAW,UAAU,UAAU;AAC7C,SAAO,CAAC,OAAO,GAAG,UAAU,QAAQ;AACtC;AAKO,SAAS,WAAW,OAAO;AAChC,SAAO,OAAO,UAAU;AAC1B;;;ACiBA,IAAI;AAOG,SAAS,KAAK,KAAK,KAAK;AAE7B,QAAM,aAAa,IAAI;AAOvB,QAAM,UAAU,eAAe,SAAY,IAAI,OAAO,WAAW;AAEjE,MAAI,WAAW,QAAQ,QAAQ,KAAK;AAClC,QAAI,WAAW;AACf;AAAA,EACF;AAIA,MAAI;AAKJ,MAAI,UAAU;AACZ,cAAU;AACV,eAAW,SAAS;AACpB,YAAQ,UAAU;AAClB,YAAQ,MAAM;AACd,YAAQ,MAAM;AAAA,EAChB,OAAO;AACL,cAAU;AAAA,MACR;AAAA,MACA;AAAA,MACA;AAAA,MACA,SAAS;AAAA,MACT,SAAS;AAAA,IACX;AAAA,EACF;AASA,MAAI,IAAI,UAAU;AAChB,QAAI,SAAS,UAAU;AACvB,YAAQ,UAAU,IAAI;AACtB,QAAI,WAAW;AAAA,EACjB,OAAO;AACL,QAAI,OAAO;AACX,QAAI,WAAW;AAAA,EACjB;AAUA,MAAI,IAAI,UAAU;AAChB,QAAI,SAAS,UAAU;AACvB,QAAI,WAAW;AAAA,EACjB,OAAO;AACL,QAAI,OAAO;AACX,QAAI,WAAW;AAAA,EACjB;AAGF;AAMO,SAAS,UAAU,MAAM;AAE9B,MAAIA,QAAO;AACX,MAAI,eAAe,CAAC;AACpB,SAAOA,OAAM;AACX,UAAM,MAAMA,MAAK;AACjB,QAAI,CAAC,IAAI,YAAY,CAAC,IAAI,OAAO;AAE/B,UAAI,QAAQ;AACZ,UAAI,YAAY,KAAK;AACnB,8BAAsB,GAAG;AAAA,MAC3B,OAAO;AACL,qBAAa,KAAKA,MAAK,GAAG;AAAA,MAC5B;AAAA,IACF;AACA,IAAAA,QAAOA,MAAK;AAAA,EACd;AACA,eAAa,QAAQ,CAAAC,YAAUA,QAAO,OAAO,CAAC;AAChD;AAMO,SAAS,WAAW,KAAK;AAC9B,MAAI,WAAW;AACf,MAAI,WAAW;AACjB;AAMO,SAAS,SAAS,KAAK;AAC5B,MAAI,WAAW;AACf,QAAM,WAAW,IAAI;AAGrB,MAAI,QAAQ;AAMZ,MAAI,UAAU;AACZ,QAAI,SAAS,SAAS;AACpB,oBAAc,SAAS,OAAO;AAC9B,eAAS,UAAU;AAAA,IACrB;AAAA,EACF,WAAW,IAAI,MAAM;AACnB,kBAAc,IAAI,IAAI;AACtB,QAAI,OAAO;AAAA,EACb;AACF;AAMA,SAAS,cAAcD,OAAY;AACjC,SAAOA,OAAM;AACX,UAAM,EAAE,SAAS,SAAS,KAAK,QAAQ,IAAIA;AAQ3C,QAAI,SAAS;AACX,cAAQ,UAAU;AAClB,MAAAA,MAAK,UAAU;AAAA,IACjB,OAAO;AACL,UAAI,OAAO;AAAA,IACb;AAGA,QAAI,SAAS;AACX,cAAQ,UAAU;AAClB,MAAAA,MAAK,UAAU;AAAA,IACjB,OAAO;AACL,UAAI,WAAW;AAAA,IACjB;AAEA,IAAAA,MAAK,MAAMA,MAAK,MAAM;AAGtB,IAAAA,MAAK,UAAU;AACf,eAAWA;AAEX,IAAAA,QAAO;AAAA,EACT;AACF;AAMA,SAAS,sBAAsB,KAAK;AAMlC,MAAI,IAAI,QAAQ,IAAI,OAAO,GAAG;AAE5B,cAAU,IAAI,IAAI;AAAA,EACpB;AACF;;;ACnOO,IAAI;AAEJ,SAAS,aAAa,KAAK;AAChC,cAAY;AACd;AAEO,IAAM,iBAAN,MAAoC;AAAA,EAezC,YAAmB,IAAI;AAAJ;AAAA,EAAK;AAAA;AAAA,EAbxB;AAAA;AAAA,EAGA;AAAA;AAAA,EAGA,WAAW;AAAA;AAAA;AAAA;AAAA,EAKX,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,EAQR,MAAM;AACJ,QAAI,CAAC,KAAK,QAAQ;AAChB,aAAO,KAAK,GAAG;AAAA,IACjB;AAEA,UAAM,UAAU;AAGhB,iBAAa,IAAI;AAEjB,eAAW,IAAI;AAEf,QAAI;AACF,aAAO,KAAK,GAAG;AAAA,IACjB,UAAE;AAEA,eAAS,IAAI;AAGb,mBAAa,OAAO;AAAA,IACtB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,SAAS;AACP,SAAK,UAAU;AAAA,EACjB;AAAA;AAAA;AAAA;AAAA,EAKA,YAAY;AACV,SAAK,IAAI;AAAA,EACX;AAAA;AAAA,EAGA,SAAS;AAAA,EAET,OAAO;AACL,QAAI,KAAK,QAAQ;AAEf,iBAAW,IAAI;AAEf,eAAS,IAAI;AAGb,WAAK,SAAS;AAAA,IAChB;AAAA,EACF;AACF;AAEO,SAAS,OAAO,IAAI,SAAS;AAClC,QAAM,IAAI,IAAI,eAAe,EAAE;AAG/B,SAAO,OAAO,GAAG,OAAO;AAExB,IAAE,IAAI;AAON,QAAM,SAAS,EAAE,IAAI,KAAK,CAAC;AAG3B,SAAO,SAAS;AAEhB,SAAO;AACT;;;AClGA,IAAM,YAAY,oBAAI,QAAQ;AAEvB,SAAS,MAAM,QAAQ,KAAK;AACjC,MAAI,CAAC,WAAW;AACd;AAAA,EACF;AASA,MAAI,UAAU,UAAU,IAAI,MAAM;AAElC,MAAI,CAAC,SAAS;AAEZ,cAAU,oBAAI,IAAI;AAClB,cAAU,IAAI,QAAQ,OAAO;AAAA,EAC/B;AAGA,MAAI,MAAM,QAAQ,IAAI,GAAG;AAEzB,MAAI,CAAC,KAAK;AAER,UAAM,IAAI,IAAI;AACd,YAAQ,IAAI,KAAK,GAAG;AAAA,EACtB;AAGA,OAAK,KAAK,SAAS;AACrB;AAEO,SAAS,QAAQ,QAAQ,KAAK;AACnC,QAAM,UAAU,UAAU,IAAI,MAAM;AASpC,MAAI,CAAC,SAAS;AAEZ;AAAA,EACF;AAEA,QAAM,gBAAgB,MAAM,QAAQ,MAAM;AAE1C,MAAI,iBAAiB,QAAQ,UAAU;AAcrC,UAAM,SAAS,OAAO;AACtB,YAAQ,QAAQ,CAAC,KAAK,WAAW;AAC/B,UAAI,UAAU,UAAU,WAAW,UAAU;AAG3C,kBAAU,IAAI,IAAI;AAAA,MACpB;AAAA,IACF,CAAC;AAAA,EACH,OAAO;AAIL,UAAM,MAAM,QAAQ,IAAI,GAAG;AAE3B,QAAI,CAAC,KAAK;AAER;AAAA,IACF;AAGA,cAAU,IAAI,IAAI;AAAA,EACpB;AACF;AAEA,IAAM,MAAN,MAAU;AAAA;AAAA,EAER;AAAA;AAAA,EAGA;AACF;;;AC9FO,IAAM,kBAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAS7B,IAAI,QAAQ,KAAK,UAAU;AACzB,UAAM,QAAQ,GAAG;AAEjB,UAAM,MAAM,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAE7C,QAAI,MAAM,GAAG,GAAG;AAGd,aAAO,IAAI;AAAA,IACb;AAEA,QAAI,SAAS,GAAG,GAAG;AAEjB,aAAO,SAAS,GAAG;AAAA,IACrB;AAGA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,IAAI,QAAQ,KAAK,UAAU,UAAU;AAEnC,UAAM,WAAW,OAAO,GAAG;AAG3B,UAAM,gBAAgB,MAAM,QAAQ,MAAM;AAC1C,UAAM,YAAY,gBAAgB,OAAO,SAAS;AAIlD,QAAI,MAAM,QAAQ,KAAK,CAAC,MAAM,QAAQ,GAAG;AAQvC,eAAS,QAAQ;AACjB,aAAO;AAAA,IACT;AAGA,UAAM,MAAM,QAAQ,IAAI,QAAQ,KAAK,UAAU,QAAQ;AAGvD,QAAI,WAAW,UAAU,QAAQ,GAAG;AAClC,cAAQ,QAAQ,GAAG;AAAA,IACrB;AAGA,UAAM,YAAY,gBAAgB,OAAO,SAAS;AAGlD,QAAI,iBAAiB,cAAc,aAAa,QAAQ,UAAU;AAShE,cAAQ,QAAQ,QAAQ;AAAA,IAC1B;AAEA,WAAO;AAAA,EACT;AACF;;;ACvFO,SAAS,SAAS,QAAQ;AAC/B,SAAO,qBAAqB,MAAM;AACpC;AAMA,IAAM,cAAc,oBAAI,QAAQ;AAKhC,IAAM,cAAc,oBAAI,QAAQ;AAEzB,SAAS,qBAAqB,QAAQ;AAE3C,MAAI,CAAC,SAAS,MAAM,GAAG;AAErB,WAAO;AAAA,EACT;AAGA,MAAI,YAAY,IAAI,MAAM,GAAG;AAC3B,WAAO;AAAA,EACT;AAGA,QAAM,iBAAiB,YAAY,IAAI,MAAM;AAG7C,MAAI,gBAAgB;AAClB,WAAO;AAAA,EACT;AAKA,QAAM,QAAQ,IAAI,MAAM,QAAQ,eAAe;AAG/C,cAAY,IAAI,QAAQ,KAAK;AAG7B,cAAY,IAAI,KAAK;AAErB,SAAO;AACT;AAmBO,SAAS,WAAW,QAAQ;AACjC,SAAO,YAAY,IAAI,MAAM;AAC/B;;;AClEO,IAAK,gBAAL,kBAAKE,mBAAL;AACL,EAAAA,eAAA,YAAS;AADC,SAAAA;AAAA,GAAA;AAOZ,IAAM,UAAN,MAAoC;AAAA;AAAA,EAElC;AAAA;AAAA,EAGA;AAAA;AAAA,EAGA;AAAA;AAAA,EAGA,CAAC,wBAAoB,IAAI;AAAA,EAEzB,YAAY,OAAO;AAEjB,SAAK,SAAS,SAAS,KAAK,IAAI,SAAS,KAAK,IAAI;AAAA,EACpD;AAAA,EAEA,IAAI,QAAQ;AAEV,QAAI,WAAW;AACb,eAAS,IAAI;AAAA,IACf;AACA,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,IAAI,MAAM,UAAU;AAElB,QAAI,WAAW,UAAU,KAAK,MAAM,GAAG;AAGrC,WAAK,SAAS,SAAS,QAAQ,IAAI,SAAS,QAAQ,IAAI;AAAA,IAC1D;AAEA,eAAW,IAAI;AAAA,EACjB;AACF;AAKO,SAAS,IAAI,OAAO;AACzB,SAAO,IAAI,QAAQ,KAAK;AAC1B;AAMO,SAAS,MAAM,OAAO;AAC3B,SAAO,CAAC,EAAE,SAAS,MAAM,wBAAoB;AAC/C;AAMO,SAAS,SAAS,KAAK;AAC5B,MAAI,WAAW;AACb,SAAK,KAAK,SAAS;AAAA,EACrB;AACF;AAMO,SAAS,WAAW,KAAK;AAC9B,MAAI,IAAI,MAAM;AACZ,cAAU,IAAI,IAAI;AAAA,EACpB;AACF;AAEA,IAAM,gBAAN,MAAoB;AAAA,EAGlB,YACS,SACA,MACP;AAFO;AACA;AAAA,EACN;AAAA,EALH,CAAC,wBAAoB,IAAI;AAAA,EAOzB,IAAI,QAAQ;AACV,WAAO,KAAK,QAAQ,KAAK,IAAI;AAAA,EAC/B;AAAA,EAEA,IAAI,MAAM,QAAQ;AAChB,SAAK,QAAQ,KAAK,IAAI,IAAI;AAAA,EAC5B;AACF;AAOO,SAAS,MAAM,QAAQ,KAAK;AACjC,SAAO,IAAI,cAAc,QAAQ,GAAG;AACtC;AAOO,SAAS,OAAO,QAAQ;AAC7B,MAAI,CAAC,WAAW,MAAM,GAAG;AACvB,YAAQ,KAAK,gFAAe;AAAA,EAC9B;AAEA,QAAM,MAAM,CAAC;AAEb,aAAW,OAAO,QAAQ;AACxB,QAAI,GAAG,IAAI,IAAI,cAAc,QAAQ,GAAG;AAAA,EAC1C;AAGA,SAAO;AACT;AAOO,SAAS,MAAM,OAAO;AAC3B,SAAO,MAAM,KAAK,IAAI,MAAM,QAAQ;AACtC;AAUO,SAAS,UAAU,QAAQ;AAChC,SAAO,IAAI,MAAM,QAAQ;AAAA,IACvB,IAAIC,SAAQ,KAAK,UAAU;AAMzB,YAAM,MAAM,QAAQ,IAAIA,SAAQ,KAAK,QAAQ;AAE7C,aAAO,MAAM,GAAG;AAAA,IAClB;AAAA,IACA,IAAIA,SAAQ,KAAK,UAAU,UAAU;AACnC,YAAM,WAAWA,QAAO,GAAG;AAG3B,UAAI,MAAM,QAAQ,KAAK,CAAC,MAAM,QAAQ,GAAG;AAQvC,iBAAS,QAAQ;AACjB,eAAO;AAAA,MACT;AAEA,aAAO,QAAQ,IAAIA,SAAQ,KAAK,UAAU,QAAQ;AAAA,IACpD;AAAA,EACF,CAAC;AACH;;;AC9KA,IAAM,kBAAN,MAAiD;AAAA,EA8B/C,YACS,IACC,QACR;AAFO;AACC;AAAA,EACP;AAAA;AAAA,EA/BH,yBAAqB,IAAI;AAAA;AAAA,EAGzB;AAAA;AAAA;AAAA,EAIA;AAAA;AAAA,EAGA;AAAA;AAAA;AAAA;AAAA,EAKA;AAAA;AAAA,EAGA;AAAA;AAAA,EAGA,WAAW;AAAA;AAAA;AAAA,EAKX,QAAQ;AAAA,EAOR,IAAI,QAAQ;AACV,QAAI,KAAK,OAAO;AAEd,WAAK,OAAO;AAAA,IACd;AAIA,QAAI,WAAW;AACb,WAAK,MAAM,SAAS;AAAA,IACtB;AAEA,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,IAAI,MAAM,UAAU;AAClB,QAAI,KAAK,QAAQ;AACf,WAAK,OAAO,QAAQ;AAAA,IACtB,OAAO;AACL,cAAQ,KAAK,0EAAc;AAAA,IAC7B;AAAA,EACF;AAAA,EAEA,SAAS;AAKP,UAAM,UAAU;AAGhB,iBAAa,IAAI;AAGjB,eAAW,IAAI;AAEf,QAAI;AAEF,YAAM,WAAW,KAAK;AAGtB,WAAK,SAAS,KAAK,GAAG;AAGtB,aAAO,WAAW,KAAK,QAAQ,QAAQ;AAAA,IACzC,UAAE;AAEA,eAAS,IAAI;AAGb,mBAAa,OAAO;AAAA,IACtB;AAAA,EACF;AACF;AAMO,SAAS,SAAS,iBAAiB;AACxC,MAAI;AACJ,MAAI;AAEJ,MAAI,WAAW,eAAe,GAAG;AAI/B,aAAS;AAAA,EACX,OAAO;AAOL,aAAS,gBAAgB;AACzB,aAAS,gBAAgB;AAAA,EAC3B;AAEA,SAAO,IAAI,gBAAgB,QAAQ,MAAM;AAC3C;;;AC5GO,SAAS,MAAM,QAAQ,IAAI,SAAS;AACzC,MAAI;AAEJ,MAAI,EAAE,WAAW,MAAM,KAAK,IAAI,WAAW,CAAC;AAE5C,MAAI,MAAM;AAER,UAAM,MAAM;AAEZ,SAAK,IAAI,SAAS;AAChB,UAAI,GAAG,IAAI;AACX,WAAK;AAAA,IACP;AAAA,EACF;AAEA,MAAI,MAAM,MAAM,GAAG;AAEjB,aAAS,MAAM,OAAO;AAAA,EACxB,WAAW,WAAW,MAAM,GAAG;AAE7B,aAAS,MAAM;AACf,QAAI,CAAC,MAAM;AACT,aAAO;AAAA,IACT;AAAA,EACF,WAAW,WAAW,MAAM,GAAG;AAE7B,aAAS;AAAA,EACX;AAEA,MAAI,MAAM;AACR,UAAM,aAAa;AACnB,UAAM,QAAQ,SAAS,OAAO,WAAW;AAEzC,aAAS,MAAM,SAAS,WAAW,GAAG,KAAK;AAAA,EAC7C;AAEA,MAAI;AAEJ,MAAI,UAAU;AAEd,WAAS,UAAUC,KAAI;AACrB,cAAUA;AAAA,EACZ;AAQA,WAAS,MAAM;AAEb,QAAI,SAAS;AACX,cAAQ;AACR,gBAAU;AAAA,IACZ;AAGA,UAAM,WAAWC,QAAO,IAAI;AAG5B,OAAG,UAAU,UAAU,SAAS;AAGhC,eAAW;AAAA,EACb;AAEA,QAAMA,UAAS,IAAI,eAAe,MAAM;AAExC,EAAAA,QAAO,YAAY;AAEnB,MAAI,WAAW;AAEb,QAAI;AAAA,EACN,OAAO;AAEL,eAAWA,QAAO,IAAI;AAAA,EACxB;AAGA,WAAS,OAAO;AACd,IAAAA,QAAO,KAAK;AAAA,EACd;AAEA,SAAO;AACT;AASA,SAAS,SAAS,OAAO,QAAQ,UAAU,OAAO,oBAAI,IAAI,GAAG;AAE3D,MAAI,CAAC,SAAS,KAAK,KAAK,SAAS,GAAG;AAElC,WAAO;AAAA,EACT;AAGA,MAAI,KAAK,IAAI,KAAK,GAAG;AACnB,WAAO;AAAA,EACT;AAGA;AAGA,OAAK,IAAI,KAAK;AAGd,aAAW,OAAO,OAAO;AACvB,aAAS,MAAM,GAAG,GAAG,OAAO,IAAI;AAEhC,WAAO;AAAA,EACT;AACF;",
  "names": ["link", "effect", "ReactiveFlags", "target", "cb", "effect"]
}
